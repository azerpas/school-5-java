name: CI

on: [push, pull_request, pull_request_target]

jobs:
    build-and-test:
      runs-on: ubuntu-latest
      if: >
        github.event_name == 'push' ||
        github.event_name == 'pull_request_target' && github.event.pull_request.head.repo.full_name != github.repository
      steps:
          - uses: actions/checkout@v2
          - uses: actions/cache@v1
            with:
              path: ~/.m2/repository
              key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
              restore-keys: |
                ${{ runner.os }}-maven-
          - name: Set up JDK 11
            uses: actions/setup-java@v1
            with:
              java-version: 11
          - name: Build with Maven
            run: mvn -B test --file pom.xml
          - uses: ashley-taylor/junit-report-annotations-action@master
            with:
              access-token: ${{ secrets.GITHUB_TOKEN }}
            if: always()